<!DOCTYPE html>
<html>
<head>
  <title>Call of Cosmos</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <script>
    const config = {
      type: Phaser.AUTO,
      width: 1920, height: 1080,
      backgroundColor: '#000011',
      scene: { preload, create, update }
    };
    const game = new Phaser.Game(config);
    let planets = [], socket;

    function preload() {
      this.load.image('star', 'data:image/svg+xml;base64,...'); // À remplacer par assets SVG étoiles/planètes
    }

    function create() {
      socket = io();
      socket.on('galaxyUpdate', (data) => {
        planets = data;
        redrawMap.call(this);
      });
      socket.on('tick', () => console.log('⏰ Tick ! Ressources +'));

      // UI Zoom/Pan
      this.cameras.main.setZoom(0.5);
      this.input.mouse.disableContextMenu();
      this.cameras.main.setBackgroundColor('#000022');

      // Clic conquête
      this.input.on('pointerdown', (pointer) => {
        planets.forEach(p => {
          const dist = Phaser.Math.Distance.Between(pointer.worldX, pointer.worldY, p.x, p.y);
          if (dist < 20) socket.emit('conquer', { id: p.id });
        });
      });
    }

    function redrawMap() {
      // Clear
      this.children.removeAll(true);
      // Dessine planètes
      planets.forEach(p => {
        const color = p.owner === 'neutre' ? 0x00ff00 : 0xff0000;
        const circle = this.add.circle(p.x, p.y, 15, color);
        this.add.text(p.x - 20, p.y - 30, `ID:${p.id}\nMetal:${p.resources.metal}`, { fontSize: '12px', color: '#fff' });
      });
    }

    function update() {}
  </script>
</body>
</html>
