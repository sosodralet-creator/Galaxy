<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soso Galaxy Conquest V3 - L'Empire Spatial</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: 'Orbitron', sans-serif; }
    #ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,50,0.8); padding: 20px; border-radius: 10px; color: white; z-index: 10; }
    button { background: #00ffff; color: black; border: none; padding: 10px; margin: 5px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #00cccc; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
</head>
<body>
<div id="ui">
  <h1>SOSO GALAXY CONQUEST</h1>
  <p>Tutoriel : Construis sur Terre → Recherche Voyage Spatial → Envoie des flottes pour conquérir !</p>
  <div id="terreControls">
    <button onclick="build('mine')">+ Mine Métal</button>
    <button onclick="build('power')">+ Centrale Énergie</button>
    <button onclick="build('lab')">+ Labo Recherche</button>
    <button onclick="build('shipyard')">+ Chantier Spatial</button>
  </div>
</div>

<script>
  const socket = io();
  let selectedPlanet = 0;

  const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#000022',
    scene: { preload, create, update }
  };
  const game = new Phaser.Game(config);

  function preload() {
    this.load.image('background', 'https://images.unsplash.com/photo-1462332420958-a05d1e145a55?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'); // Fond galaxie HD
    this.load.image('earth', 'https://www.sciencealert.com/images/2021-03/processed/EarthFromSpace_1024.jpg'); // Terre stylée
    this.load.image('alienPlanet', 'https://wallpapercave.com/wp/wp1812778.jpg'); // Planètes alien
    this.load.image('ship', 'https://i.imgur.com/O2W5Z3f.png'); // Vaisseau simple
  }

  function create() {
    this.add.image(960, 540, 'background').setDepth(-1).setScale(1.5);

    socket.on('galaxyUpdate', (data) => {
      this.children.removeAll(p => p.type !== 'Image' || p.texture.key !== 'background'); // Garde fond

      data.planets.forEach(p => {
        const img = p.isHome ? 'earth' : 'alienPlanet';
        const planet = this.add.image(p.x, p.y, img).setInteractive().setScale(0.2);
        planet.on('pointerdown', () => selectedPlanet = p.id);

        this.add.text(p.x - 100, p.y - 100, p.name, { color: '#00ffff', fontSize: '20px' });
      });

      data.fleets.forEach(f => {
        const from = data.planets.find(p => p.id === f.from);
        const to = data.planets.find(p => p.id === f.to);
        if (from && to) {
          const ship = this.add.image(from.x + (to.x - from.x) * (f.progress / 100), from.y + (to.y - from.y) * (f.progress / 100), 'ship').setScale(0.1);
        }
      });
    });
  }

  function update() {}

  function build(type) {
    socket.emit('build', { planetId: 0, building: type });
  }

  // Envoi flotte (clic droit ou bouton futur)
  document.addEventListener('contextmenu', e => e.preventDefault());
</script>
</body>
</html>
